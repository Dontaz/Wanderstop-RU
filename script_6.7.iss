#define MyAppName "–†—É—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è Wanderstop"
#define MyAppVersion "1.06 [20260128]"
#define MyAppPublisher "Dontaz"
#define MyAppURL "https://steamcommunity.com/sharedfiles/filedetails/?id=3479356545"
#define MyAppBoosty "https://boosty.to/dontaz"
#define MyAppDonationAlerts "https://www.donationalerts.com/r/dontaz" 
#define GameName "Wanderstop"

[Setup]
AppId={{E2A8C1B4-473C-4321-AFFD-5D6E06F4WNDR}
AppName={#MyAppName}
AppVersion={#MyAppVersion}
AppPublisher={#MyAppPublisher}
AppPublisherURL={#MyAppURL}
AppSupportURL={#MyAppURL}
AppUpdatesURL={#MyAppURL}
DefaultDirName={code:GetGamePath}
DefaultGroupName={#MyAppName}
DisableProgramGroupPage=yes
PrivilegesRequired=lowest
OutputDir=C:\Users\user\Desktop\Programs\Unreal Engine Modding\UnrealPak\–†—É—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä Wanderstop
OutputBaseFilename=–†—É—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è Wanderstop
SolidCompression=yes
WizardStyle=modern dynamic
WizardSizePercent=150
UsePreviousAppDir=no
DisableDirPage=no
DirExistsWarning=no
AppendDefaultDirName=no
UninstallDisplayName=–£–¥–∞–ª–µ–Ω–∏–µ —Ä—É—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ Wanderstop
UninstallFilesDir={app}\–£–¥–∞–ª–µ–Ω–∏–µ —Ä—É—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
WizardImageFile=sidebar_new.png
WizardSmallImageFile=small.png
WizardImageFileDynamicDark=sidebar_new.png
WizardSmallImageFileDynamicDark=small.png
DisableWelcomePage=no
VersionInfoCompany=Dontaz
VersionInfoDescription={#MyAppURL}
VersionInfoVersion=1.0.6
VersionInfoProductName={#MyAppName}
VersionInfoCopyright=MIT License

[Languages]
Name: "russian"; MessagesFile: "compiler:Languages\Russian.isl"

[Files]
Source: "C:\Users\user\Desktop\Programs\Unreal Engine Modding\UnrealPak\–†—É—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä Wanderstop\–£—Å—Ç–∞–Ω–æ–≤—â–∏–∫\*"; DestDir: "{app}"; Flags: ignoreversion recursesubdirs createallsubdirs

[CustomMessages]
WelcomeTitle=–í–∞—Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–∞—Å—Ç–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä—É—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ Wanderstop
WelcomeText=–î–∞–Ω–Ω—ã–π –º–∞—Å—Ç–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä—É—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–≤–µ—Ä—Å–∏—è {#MyAppVersion}) –¥–ª—è –∏–≥—Ä—ã {#GameName}.%n%n–ê–≤—Ç–æ—Ä –ø–µ—Ä–µ–≤–æ–¥–∞: {#MyAppPublisher}.%n–ü—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö –ø—Ä–æ—Å—å–±–∞ —É–∫–∞–∑—ã–≤–∞—Ç—å –∞–≤—Ç–æ—Ä—Å—Ç–≤–æ.%n%n–ù–∞–∂–∏–º–∞—è ¬´–î–∞–ª–µ–µ¬ª, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
VisitLink=üåê –ù–∞–π—Ç–∏ —Å–∞–º—É—é –∞–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é (Steam –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ)
BoostyLink=üß° –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –ø–µ—Ä–µ–≤–æ–¥–∞
DisclaimerLink=‚ö†Ô∏è –£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–ß–∏—Ç–∞—Ç—å)
DisclaimerFullText=–£–°–õ–û–í–ò–Ø –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:%n%n1. –î–∞–Ω–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ —è–≤–ª—è–µ—Ç—Å—è –Ω–µ–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –∏ —Ñ–∞–Ω–∞—Ç—Å–∫–∏–º. –û–Ω —Å–æ–∑–¥–∞–Ω –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤ –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ. –ê–≤—Ç–æ—Ä –Ω–µ –ø—Ä–µ—Å–ª–µ–¥—É–µ—Ç –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ü–µ–ª–µ–π.%n%n2. –í—Å–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∏–≥—Ä—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –µ—ë –∫–æ–º–ø–∞–Ω–∏–∏-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –∏ –∏–∑–¥–∞—Ç–µ–ª—é. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–¥–µ—Ä–∂–∏—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ–∫—É–ø–∫–æ–π –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω–æ–π –∫–æ–ø–∏–∏.%n%n3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ, –ø–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ –∏ –ø–æ–¥ –µ–≥–æ –ª–∏—á–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å.%n%n4. –ê–≤—Ç–æ—Ä –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω–µ–ø–æ–ª–∞–¥–∫–∏ –∏–ª–∏ —É—Ç—Ä–∞—Ç—É –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É—è –¥–∞–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ, —á—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –Ω–∞ —Å–µ–±—è –≤—Å–µ —Ä–∏—Å–∫–∏.

[Code]
var
  VisitLabel: TNewStaticText;
  BoostyLabel: TNewStaticText;
  DisclaimerLabel: TNewStaticText;
  SupportForm: TForm;
  LinkColor: TColor;

procedure OpenUrl(Url: String);
var
  ErrorCode: Integer;
begin
  ShellExec('open', Url, '', '', SW_SHOWNORMAL, ewNoWait, ErrorCode);
end;

procedure BoostyBtnClick(Sender: TObject);
begin
  OpenUrl(ExpandConstant('{#MyAppBoosty}'));
  if SupportForm <> nil then SupportForm.Close;
end;

procedure DABtnClick(Sender: TObject);
begin
  OpenUrl(ExpandConstant('{#MyAppDonationAlerts}'));
  if SupportForm <> nil then SupportForm.Close;
end;

procedure CloseSupportClick(Sender: TObject);
begin
  if SupportForm <> nil then SupportForm.Close;
end;

procedure ShowSupportWindow;
var
  TitleLabel: TLabel;
  DescLabel: TLabel;
  BtnBoosty, BtnDA, DummyBtn: TNewButton;
  CloseLabel: TLabel;
begin
  SupportForm := TForm.Create(WizardForm);
  try
    SupportForm.ClientWidth := ScaleX(340);
    SupportForm.ClientHeight := ScaleY(260);
    SupportForm.Caption := '–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞';
    SupportForm.Position := poMainFormCenter;
    SupportForm.BorderStyle := bsDialog;
    
    SupportForm.Color := WizardForm.Color;
    SupportForm.Font.Color := WizardForm.Font.Color;

    DummyBtn := TNewButton.Create(SupportForm);
    DummyBtn.Parent := SupportForm;
    DummyBtn.Width := 0;
    DummyBtn.Height := 0;
    DummyBtn.Left := -100;
    DummyBtn.Default := True;

    TitleLabel := TLabel.Create(SupportForm);
    TitleLabel.Parent := SupportForm;
    TitleLabel.Caption := '–í–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è –ø–µ—Ä–µ–≤–æ–¥?';
    TitleLabel.Font.Name := 'Segoe UI';
    TitleLabel.Font.Size := 14;
    TitleLabel.Font.Style := [fsBold];
    TitleLabel.Font.Color := SupportForm.Font.Color; 
    TitleLabel.AutoSize := False;
    TitleLabel.Alignment := taCenter;
    TitleLabel.Left := 0;
    TitleLabel.Width := SupportForm.ClientWidth;
    TitleLabel.Top := ScaleY(25);
    TitleLabel.Transparent := True;

    DescLabel := TLabel.Create(SupportForm);
    DescLabel.Parent := SupportForm;
    DescLabel.Caption := '–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–¥–µ—Ä–∂–∫–∏:';
    DescLabel.Font.Color := SupportForm.Font.Color;
    DescLabel.Font.Size := 9;
    DescLabel.WordWrap := True;
    DescLabel.AutoSize := False;
    DescLabel.Alignment := taCenter;
    DescLabel.Left := ScaleX(10);
    DescLabel.Width := SupportForm.ClientWidth - ScaleX(20);
    DescLabel.Top := ScaleY(60);
    DescLabel.Height := ScaleY(40);
    DescLabel.Transparent := True;

    BtnBoosty := TNewButton.Create(SupportForm);
    BtnBoosty.Parent := SupportForm;
    BtnBoosty.Width := ScaleX(280);
    BtnBoosty.Height := ScaleY(40);
    BtnBoosty.Left := (SupportForm.ClientWidth - BtnBoosty.Width) div 2;
    BtnBoosty.Top := ScaleY(110);
    BtnBoosty.Caption := 'üü†  –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –Ω–∞ Boosty'; 
    BtnBoosty.Cursor := crHandPoint;
    BtnBoosty.Font.Style := [fsBold];
    BtnBoosty.Font.Size := 10;
    BtnBoosty.OnClick := @BoostyBtnClick;
    BtnBoosty.TabOrder := 1;

    BtnDA := TNewButton.Create(SupportForm);
    BtnDA.Parent := SupportForm;
    BtnDA.Width := ScaleX(280);
    BtnDA.Height := ScaleY(40);
    BtnDA.Left := (SupportForm.ClientWidth - BtnDA.Width) div 2;
    BtnDA.Top := ScaleY(160);
    BtnDA.Caption := 'üü†  –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –Ω–∞ DonationAlerts';
    BtnDA.Cursor := crHandPoint;
    BtnDA.Font.Style := [fsBold];
    BtnDA.Font.Size := 10;
    BtnDA.OnClick := @DABtnClick;
    BtnDA.TabOrder := 2;

    CloseLabel := TLabel.Create(SupportForm);
    CloseLabel.Parent := SupportForm;
    CloseLabel.Caption := '–°–ø–∞—Å–∏–±–æ, –Ω–æ –≤ –¥—Ä—É–≥–æ–π —Ä–∞–∑';
    CloseLabel.Cursor := crHandPoint;
    
    if SupportForm.Color = clWhite then
       CloseLabel.Font.Color := $808080
    else
       CloseLabel.Font.Color := $C0C0C0;

    CloseLabel.Font.Style := [fsUnderline];
    CloseLabel.Font.Size := 9;
    CloseLabel.OnClick := @CloseSupportClick;
    CloseLabel.AutoSize := False;
    CloseLabel.Alignment := taCenter;
    CloseLabel.Left := 0;
    CloseLabel.Width := SupportForm.ClientWidth;
    CloseLabel.Top := ScaleY(225);
    CloseLabel.Transparent := True;

    SupportForm.ShowModal;
  finally
    SupportForm.Free;
    SupportForm := nil;
  end;
end;

procedure LinkLabelClick(Sender: TObject);
begin
  OpenUrl(ExpandConstant('{#MyAppURL}'));
end;

procedure BoostyLabelClick(Sender: TObject);
begin
  ShowSupportWindow();
end;

procedure ShowDisclaimerBox(Sender: TObject);
begin
  MsgBox(CustomMessage('DisclaimerFullText'), mbInformation, MB_OK);
end;

procedure DisclaimerLabelClick(Sender: TObject);
begin
  ShowDisclaimerBox(Sender);
end;

procedure InitializeWizard;
var
  BottomMargin: Integer;
begin
  BottomMargin := ScaleY(100);

  if WizardForm.Font.Color = clWhite then
    LinkColor := $00A5FF 
  else
    LinkColor := clBlue;

  WizardForm.WelcomeLabel1.Caption := CustomMessage('WelcomeTitle');
  WizardForm.WelcomeLabel2.Caption := CustomMessage('WelcomeText');
  
  WizardForm.WelcomeLabel2.Height := WizardForm.WelcomePage.Height - WizardForm.WelcomeLabel2.Top - BottomMargin;

  VisitLabel := TNewStaticText.Create(WizardForm);
  VisitLabel.Parent := WizardForm.WelcomePage;
  VisitLabel.Caption := CustomMessage('VisitLink');
  VisitLabel.Font.Color := LinkColor; 
  VisitLabel.Font.Style := [fsUnderline];
  VisitLabel.Cursor := crHandPoint;
  VisitLabel.OnClick := @LinkLabelClick;
  
  VisitLabel.Left := WizardForm.WelcomeLabel2.Left;
  VisitLabel.Top := WizardForm.WelcomeLabel2.Top + WizardForm.WelcomeLabel2.Height + ScaleY(10);
  VisitLabel.Width := WizardForm.WelcomeLabel2.Width;

  BoostyLabel := TNewStaticText.Create(WizardForm);
  BoostyLabel.Parent := WizardForm.WelcomePage;
  BoostyLabel.Caption := CustomMessage('BoostyLink');
  BoostyLabel.Font.Color := LinkColor;
  BoostyLabel.Font.Style := [fsUnderline];
  BoostyLabel.Cursor := crHandPoint;
  BoostyLabel.OnClick := @BoostyLabelClick;
  
  BoostyLabel.Left := WizardForm.WelcomeLabel2.Left;
  BoostyLabel.Top := VisitLabel.Top + VisitLabel.Height + ScaleY(10);
  BoostyLabel.Width := WizardForm.WelcomeLabel2.Width;

  DisclaimerLabel := TNewStaticText.Create(WizardForm);
  DisclaimerLabel.Parent := WizardForm.WelcomePage;
  DisclaimerLabel.Caption := CustomMessage('DisclaimerLink');
  
  DisclaimerLabel.Font.Color := LinkColor;
  DisclaimerLabel.Font.Style := [fsUnderline];
  DisclaimerLabel.Cursor := crHandPoint;
  DisclaimerLabel.OnClick := @DisclaimerLabelClick;
  
  DisclaimerLabel.Left := WizardForm.WelcomeLabel2.Left;
  DisclaimerLabel.Top := BoostyLabel.Top + BoostyLabel.Height + ScaleY(10);
  DisclaimerLabel.Width := WizardForm.WelcomeLabel2.Width;
end;

function GetSteamPath(): String;
var
  RegPath: String;
begin
  RegPath := '';
  if RegQueryStringValue(HKLM64, 'SOFTWARE\Valve\Steam', 'InstallPath', RegPath) then
  begin
    Result := RegPath;
    Exit;
  end;
  if RegQueryStringValue(HKLM, 'SOFTWARE\Valve\Steam', 'InstallPath', RegPath) then
  begin
    Result := RegPath;
    Exit;
  end;
  Result := ExpandConstant('{commonpf}\Steam');
end;

function GetValueFromLine(const Line: String): String;
var
  StartPos, EndPos: Integer;
  TempStr: String;
begin
  Result := '';
  TempStr := Line;
  while (Length(TempStr) > 0) and (TempStr[1] = ' ') do Delete(TempStr, 1, 1);
  StartPos := Pos('"', TempStr);
  if StartPos > 0 then
  begin
    Delete(TempStr, 1, StartPos);
    StartPos := Pos('"', TempStr);
    if StartPos > 0 then
    begin
      Delete(TempStr, 1, StartPos);
      StartPos := Pos('"', TempStr);
      if StartPos > 0 then
      begin
        Delete(TempStr, 1, StartPos);
        EndPos := Pos('"', TempStr);
        if EndPos > 0 then Result := Copy(TempStr, 1, EndPos - 1);
      end;
    end;
  end;
end;

function CheckCommonPirateLocations(): String;
var
  i: Integer;
  GamePath: String;
  CommonDirs: array[0..9] of String;
begin
  Result := '';
  CommonDirs[0] := 'C:\Games\{#GameName}';
  CommonDirs[1] := 'C:\–ò–≥—Ä—ã\{#GameName}';
  CommonDirs[2] := 'C:\Program Files\{#GameName}';
  CommonDirs[3] := 'C:\Program Files (x86)\{#GameName}';
  CommonDirs[4] := 'C:\{#GameName}';
  CommonDirs[5] := 'D:\Games\{#GameName}';
  CommonDirs[6] := 'D:\–ò–≥—Ä—ã\{#GameName}';
  CommonDirs[7] := 'D:\{#GameName}';
  CommonDirs[8] := 'E:\Games\{#GameName}';
  CommonDirs[9] := ExpandConstant('{userdesktop}\{#GameName}');
  
  for i := 0 to 9 do
  begin
    if DirExists(CommonDirs[i]) then
    begin
      Result := CommonDirs[i];
      Exit;
    end;
  end;
  
  for i := 65 to 90 do
  begin
    GamePath := Chr(i) + ':\{#GameName}';
    if DirExists(GamePath) then begin Result := GamePath; Exit; end;
    GamePath := Chr(i) + ':\Games\{#GameName}';
    if DirExists(GamePath) then begin Result := GamePath; Exit; end;
    GamePath := Chr(i) + ':\–ò–≥—Ä—ã\{#GameName}';
    if DirExists(GamePath) then begin Result := GamePath; Exit; end;
    GamePath := Chr(i) + ':\–ò–≥—Ä–∞\{#GameName}';
    if DirExists(GamePath) then begin Result := GamePath; Exit; end;
    GamePath := Chr(i) + ':\Game\{#GameName}';
    if DirExists(GamePath) then begin Result := GamePath; Exit; end;
    GamePath := Chr(i) + ':\Games\–ò–≥—Ä—ã\{#GameName}';
    if DirExists(GamePath) then begin Result := GamePath; Exit; end;
    GamePath := Chr(i) + ':\–ò–≥—Ä—ã\Games\{#GameName}';
    if DirExists(GamePath) then begin Result := GamePath; Exit; end;
  end;
end;

function GetGamePath(Param: String): String;
var
  DefaultPath, SteamPath, LibraryFoldersFile: String;
  GamePath, TempPath: String;
  i, LineCount: Integer;
  FileLines: TArrayOfString;
  Line: String;
begin
  SteamPath := GetSteamPath();
  DefaultPath := SteamPath + '\steamapps\common\{#GameName}';
  
  if DirExists(DefaultPath) then
  begin
    Result := DefaultPath;
    Exit;
  end;
  
  GamePath := '\home\deck\.local\share\Steam\steamapps\common\{#GameName}';
  if DirExists(GamePath) then
  begin
    Result := GamePath;
    Exit;
  end;
  
  LibraryFoldersFile := SteamPath + '\steamapps\libraryfolders.vdf';
  
  if FileExists(LibraryFoldersFile) then
  begin
    if LoadStringsFromFile(LibraryFoldersFile, FileLines) then
    begin
      LineCount := GetArrayLength(FileLines);
      for i := 0 to LineCount - 1 do
      begin
        Line := FileLines[i];
        if Pos('"path"', Line) > 0 then
        begin
          TempPath := GetValueFromLine(Line);
          if TempPath <> '' then
          begin
            GamePath := TempPath + '\steamapps\common\{#GameName}';
            StringChange(GamePath, '\\', '\');
            if DirExists(GamePath) then
            begin
              Result := GamePath;
              Exit;
            end;
          end;
        end;
      end;
    end;
  end;
  
  for i := 65 to 90 do
  begin
    GamePath := Chr(i) + ':\SteamLibrary\steamapps\common\{#GameName}';
    if DirExists(GamePath) then begin Result := GamePath; Exit; end;
    GamePath := Chr(i) + ':\Steam\steamapps\common\{#GameName}';
    if DirExists(GamePath) then begin Result := GamePath; Exit; end;
  end;
  
  GamePath := CheckCommonPirateLocations();
  if GamePath <> '' then
  begin
    Result := GamePath;
    Exit;
  end;
  
  Result := 'C:\Program Files (x86)\Steam\steamapps\common\{#GameName}';
end;